<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Command Center</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            background: #0d110d;
            color: #d4d4c8;
            font-family: 'Newsreader', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            margin: 0;
        }

        h1 {
            font-weight: 200;
            letter-spacing: 0.2em;
            color: rgba(212, 212, 200, 0.5);
        }

        .controls {
            width: 100%;
            max-width: 400px;
            display: grid;
            gap: 1rem;
        }

        input {
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(212, 212, 200, 0.2);
            color: #d4d4c8;
            padding: 0.8rem;
            text-align: center;
            font-family: inherit;
            width: 100%;
            box-sizing: border-box;
        }

        button {
            background: transparent;
            border: 1px solid rgba(212, 212, 200, 0.3);
            color: #d4d4c8;
            padding: 1.2rem;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background: rgba(212, 212, 200, 0.1);
        }

        .active {
            background: #4a5e4a !important;
            border-color: #d4d4c8 !important;
            box-shadow: 0 0 15px rgba(74, 94, 74, 0.5);
        }

        #debug {
            font-size: 0.7rem;
            margin-top: 1rem;
            color: #5e4a4a;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <div id="sync-status"
        style="width: 10px; height: 10px; border-radius: 50%; background: #5e4a4a; position: fixed; top: 20px; right: 20px;">
    </div>
    <h1>COMMAND CENTER</h1>
    <div id="debug">SYNC: STANDBY</div>

    <div class="controls">
        <input type="text" id="tony-id" value="TonyPort" placeholder="Tony Stream ID">
        <input type="text" id="court-id" value="CourtPort" placeholder="Court Stream ID">
        <input type="text" id="room-id" value="TheCommonRoom_111" placeholder="Room Name">
        <button onclick="initFeeds()">INITIATE RITUAL FEEDS</button>
        <hr style="width: 100%; opacity: 0.1; margin: 1rem 0;">
        <button id="curtain-btn" onclick="toggleCurtain()">OPEN CURTAIN</button>
        <button onclick="broadcast({type: 'START_AMBIENT'})">START AMBIENT</button>
        <button onclick="broadcast({type: 'STOP_AMBIENT'})">STOP AMBIENT</button>
        <input type="text" id="omen-text" placeholder="Type an Omen here...">
        <button onclick="broadcast({type: 'ACTIVATE_OMEN', text: document.getElementById('omen-text').value})">SEND
            OMEN</button>
    </div>

    <script>
        const SUPABASE_URL = 'https://eusqhncaalxcdkpfqgbd.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV1c3FobmNhYWx4Y2RrcGZxZ2JkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzEyNjcsImV4cCI6MjA4Njc0NzI2N30.lYWeqibGAldOXeubtdiYEF8UJESUeFjLqzwh14WYNRU';
        let supabase, channel;
        let curtainOpen = false;

        function connect() {
            if (typeof window.supabase === 'undefined') { setTimeout(connect, 500); return; }
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            channel = supabase.channel('common_space_ritual', { config: { broadcast: { self: true } } });
            channel.subscribe(status => {
                document.getElementById('debug').textContent = `SYNC: ${status}`;
                document.getElementById('sync-status').style.background = status === 'SUBSCRIBED' ? '#4a5e4a' : '#5e4a4a';
            });
        }
        connect();

        function broadcast(msg) {
            if (channel) channel.send({ type: 'broadcast', event: 'command', payload: msg });
            new BroadcastChannel('common_space_ritual').postMessage(msg);
        }

        function initFeeds() {
            broadcast({
                type: 'UPDATE_STREAMS',
                tony: document.getElementById('tony-id').value,
                court: document.getElementById('court-id').value,
                room: document.getElementById('room-id').value
            });
        }

        function toggleCurtain() {
            curtainOpen = !curtainOpen;
            const btn = document.getElementById('curtain-btn');
            btn.classList.toggle('active', curtainOpen);
            btn.textContent = curtainOpen ? 'CLOSE CURTAIN' : 'OPEN CURTAIN';
            broadcast({ type: curtainOpen ? 'OPEN_CURTAIN' : 'CLOSE_CURTAIN' });
        }
    </script>
</body>

</html>